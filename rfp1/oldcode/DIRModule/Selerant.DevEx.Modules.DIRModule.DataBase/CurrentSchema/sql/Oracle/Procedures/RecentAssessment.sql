CREATE OR REPLACE PACKAGE DXDIR_PK_RECENT_ASSESSMENT AS

	PROCEDURE InsertRecord
	(
		dcUSER_ID NUMBER,
		sCODE VARCHAR2,
		daTIMESTAMP DATE
	);

	PROCEDURE UpdateRecord
	(
		dcUSER_ID NUMBER,
		sCODE VARCHAR2,
		daTIMESTAMP DATE
	);

	PROCEDURE DeleteRecord
	(
		dcUSER_ID NUMBER,
		sCODE VARCHAR2
	);

	PROCEDURE UpdateList
	(
		dcUSER_ID NUMBER,
		dcMAX_COUNT NUMBER
	);

END;
/

CREATE OR REPLACE PACKAGE BODY DXDIR_PK_RECENT_ASSESSMENT AS

	PROCEDURE InsertRecord
	(
		dcUSER_ID NUMBER,
		sCODE VARCHAR2,
		daTIMESTAMP DATE
	)
	IS
	BEGIN
		INSERT INTO DXDIR_RECENT_ASSESSMENT
		(
			USER_ID,
			CODE,
			TIMESTAMP
		)
		VALUES
		(
			dcUSER_ID,
			sCODE,
			daTIMESTAMP
		);
	END;

	PROCEDURE UpdateRecord
	(
		dcUSER_ID NUMBER,
		sCODE VARCHAR2,
		daTIMESTAMP DATE
	)
	IS
	BEGIN
		UPDATE DXDIR_RECENT_ASSESSMENT
		SET 
			TIMESTAMP = daTIMESTAMP
		WHERE
			USER_ID = dcUSER_ID
			AND CODE = sCODE;
	END;

	PROCEDURE DeleteRecord
	(
		dcUSER_ID NUMBER,
		sCODE VARCHAR2
	)
	IS
	BEGIN
		DELETE FROM DXDIR_RECENT_ASSESSMENT
		WHERE
			USER_ID = dcUSER_ID
			AND CODE = sCODE;
	END;

	PROCEDURE UpdateList
	(
		dcUSER_ID NUMBER,
		dcMAX_COUNT NUMBER
	)
	IS
	BEGIN
		DELETE FROM DXDIR_RECENT_ASSESSMENT
		WHERE (CODE) IN
			(SELECT CODE FROM (SELECT ROWNUM P, CODE FROM
			(SELECT * FROM DXDIR_RECENT_ASSESSMENT WHERE USER_ID = dcUSER_ID ORDER BY TIMESTAMP DESC)) WHERE p > dcMAX_COUNT)
		;
	END;

END;
/
